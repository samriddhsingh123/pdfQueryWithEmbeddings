package com.pdfQuery.example.pdfQuery.service;

import org.springframework.stereotype.Service;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.ai.chat.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.ollama.OllamaChatClient;
import reactor.core.publisher.Mono;

@Service
public class PdfQnAService {

    private final OllamaChatClient ollamaChatClient;

    public PdfQnAService(OllamaChatClient ollamaChatClient) {
        this.ollamaChatClient = ollamaChatClient;
    }

    public Mono<String> askQuestion(String pdfContent, String question) {
        String fullText = pdfContent + "\nQuestion: " + question;
        Prompt prompt = new Prompt(fullText);
        return ollamaChatClient.stream(prompt)
            .next()
            .map(ChatResponse::getText); // Convert the response into text.
    }
}
